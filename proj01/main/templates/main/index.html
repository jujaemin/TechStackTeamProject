{% load static %}

<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
        <link rel="shortcut icon" type="image/png" href="{% static 'images/favicon.svg' %}">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+KR&display=swap">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nanum+Gothic:400,700&display=swap">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nanum+Barun+Gothic:400,700&display=swap">
        <title>{% block title %}Techrank.{% endblock title %}</title>
    </head>
    <body>
        {% block content %}
        <div class="container">
            <div class="banner">
                <img src="{% static 'images/logo.svg' %}" alt="logo" class="logo_img" />
                <p>신입 개발자를 위한 기술 스택 랭킹 정보</p>
                <h1>최근 기업들이 신입에게 요구하는<br>기술 스택을 확인해 보세요!</h1>
            </div>
            <div class="search">
                <form action="{% url 'main:result_view' %}" method="POST">
                    {% csrf_token %}
                    <!-- form 만들어서 수정하기
                    {{ form.job_position }}
                    {{ form.location }}
                    -->
                    <select name="job_position">
                        <option value="" disabled selected>직무</option>
                        {% for job_position in job_positions %}
                            <option value="{{ job_position.name }}">{{ job_position.name }}</option>
                        {% endfor %}
                    </select>

                    <select name="location_sido" id="sido">
                        <option value="" disabled selected>지역</option>
                        {% for sido in location_sido %}
                            <option value="{{ sido }}">{{ sido }}</option>
                        {% endfor %}
                    </select>
                    <select name="location_sigg" id="sigg">
                        <option value="" disabled selected>상세지역</option>
                        {% for sigg in location_sigg %}
                            <option value="{{ sigg }}" >{{ sigg }}</option>
                        {% endfor %}
                    </select>
                    <button type="submit">검색하기</button>
                </form>
            </div>
        </div>    
        {% endblock content %}
        <script>
            // 시/도(select id = sido) 요소와 시/군구(select id = sigg) 요소 가져오기
            const sidoSelect = document.getElementById('sido');
            const siggSelect = document.getElementById('sigg');
        
            // 시/도 선택 상자가 변경될 때 실행할 함수를 정의
            sidoSelect.addEventListener('change', function () {
                const selectedSido = sidoSelect.value;
        
                // 시/도를 선택하지 않은 경우 시/군구 선택 상자를 비활성화하고 초기화
                if (!selectedSido) {
                    siggSelect.innerHTML = '<option value="" disabled selected>상세지역</option>';
                    siggSelect.disabled = true;
                } else {
                    // 시/도를 선택한 경우, AJAX 요청으로 서버에서 해당 시/도에 속하는 시/군구 목록을 가져오기
                    fetch(`/get_sigg_list/?sido=${selectedSido}`)
                        .then(response => response.json())
                        .then(data => {
                            siggSelect.innerHTML = '<option value="" disabled selected>상세지역</option>';
        
                            // 서버에서 받은 데이터로 시/군구 선택 상자를 업데이트
                            data.forEach(sigg => {
                                siggSelect.innerHTML += `<option value="${sigg.name}">${sigg.name}</option>`;
                            });
        
                            // 시/군구 선택 상자를 활성화
                            siggSelect.disabled = false;
                        });
                }
            });
        </script>
    </body>
</html>